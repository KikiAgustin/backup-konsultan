<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>d'Fun Station</title>
    <meta content="IE=edge" http-equiv="x-ua-compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">

    <!-- Fonts -->
    <!-- Styles -->
    <link href="css/keyframes.css" rel="stylesheet" type="text/css">
    <link href="css/materialize.min.css" rel="stylesheet" type="text/css">
    <link href="css/swiper.css" rel="stylesheet" type="text/css">
    <link href="css/swipebox.min.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
	<script src="js/jq.js"></script>
	<script src="js/fastclick.js"></script>
	<script type="text/javascript">
    
	var url = window.location.pathname;
    var filename = url.substring(url.lastIndexOf('/') + 1);
	
 
    if (localStorage.login == "true" && filename == 'login.html') {
        window.location.href = "index.html";
		var userfullname = localStorage.userfullname;
    } else if (localStorage.login == null) {
        window.location.href = "login.html";
    } else if (localStorage.login == "false" && filename != 'login.html') {
        window.location.href = "login.html";
    }
   </script>
   <script src="js/sweetalert.min.js"></script>
   <script>
	 	$(document).ready(function(){
		  var chatid = getvar("chatid");
		  var us = getvar("userid");
		  var urls ="https://www.dfunstation.com/api4/consultant/index.php/konsultasi/chat-finish/"+chatid+"/"+localStorage.userid+"/?callback=?";
		  $.ajax({
			  type: "GET",
			  url: urls,
			  crossDomain: true,
			  cache: false,
			  success: function(data){
				
				  if(data['status']=="OK")
				  {
					$("#avatar").attr("src",data['avatar']);
					$("#kons").html(data['konsultan']);
					$("#name-area").html(data['create']);
					var rate ="javascript:fade(\'konsultan_chat-showrate.html?chatid="+chatid+"\')";
					var v ="<i class=\'fal fa-star\'></i> Lihat Rating";
					$("#ratechat").attr("href",rate);
					$("#ratechat").html(v);
					if(data['finish']==0 && data['diff'] > 2) {
						$("#delete").show();
						var del ="javascript:onclick(\'delchat()\')";
						$("#delete").attr("href",del);
					} else {
						$("#delete").hide();
						$("#delete").attr("href","#");
					}
					$(".templates").html(data['text']);
				  }
				 
			  }
		  });
	      
	  });
	  function modalx(identifier) {
            document.getElementById("myModal").style.display = "block";
            var link = $(identifier).data("link");
            $("#imgx").attr("src", link);
            var openx = "javascript:window.open('"+link+"', '_system', 'location=yes')";
            $("#dnx").attr("href", openx);
        }

        function modalc() {
            document.getElementById("myModal").style.display = "none";
            $("#imgx").attr("src", "");
            $("#dnx").attr("href", "");
        }
	</script>
   <script type="text/javascript" src="js/iscroll.js"></script>
   <script type="text/javascript" src="js/main-chat-konsultan.js"></script>
   <style>
	.modalx {
		display: none; /* Hidden by default */
		position: fixed; /* Stay in place */
		z-index: 1; /* Sit on top */
		left: 0;
		top: 0;
		width: 100%; /* Full width */
		height: 100%; /* Full height */
		overflow: auto; /* Enable scroll if needed */
		background-color: rgb(0,0,0); /* Fallback color */
		background-color: rgba(0,0,0,0.8);
		z-index: 9999;
	}

	/* Modal Content/Box */
	.modal-contentx {
		margin: 0% auto; /* 15% from the top and centered */
		padding: 0px;
		width: 95%; /* Could be more or less, depending on screen size */
	}

	/* The Close Button */
	.close {
		color: #fff;
		float: right;
		font-size: 28px;
		font-weight: bold;
		margin-top: 20px;
		margin-bottom: 20px;
	}

	.close:hover,
	.close:focus {
		color: #aaa;
		text-decoration: none;
		cursor: pointer;
	}
</style>
</head>

  <body>
    <div class="m-scene" id="main">  
      <div id="content" class="grey-blue page" style="margin-top:0px !important;padding-top:56px;background: #efe7dd url('img/wa.jpg') repeat;background-size: cover;">

        <!-- Toolbar -->
        <div id="toolbar"  class="primary-color">
         <a href="javascript:fade('konsultan_chat.html')" class="open-left waves-effect waves-circle">
            <i class="fal fa-arrow-left"></i>
          </a>
		  <img id="avatar" class="circle avatar" src="img/avatar.png" alt="" style="margin-top:5px;float:left"/>
		  <span id="kons" style="margin-left:10px;color:white;font-size:18px;font-weight:bold;line-height:50px">Chat</span>
	  </div>
        
         <!-- Main Content -->
            
             <!-- Main Content -->
        <div class="animated fadeinup">
            <div class="row">
              <div class="col s12">
              
              
               <p id="name-area" style="padding:5px;text-align:center;font-weight:bold;margin:0px !important"></p>
    
    			<div id="chat-wrap">
                <div class="chat">
                	<ul id="chat-area" class="chat-area" style="padding-bottom:50px !important">
                    </ul>
                </div>
                </div>
              
              </div>
          </div>
            
        </div> 
        
        <div class="p-20 notification notification-warning">
        <center>
        Chat ini sudah selesai atau habis waktu. Anda bisa memulai chat lagi dengan
        membuat sesi baru
        <br clear="all"> <br clear="all">
			<a id="delete" class="btn btn-block danger waves-effect waves-effect" href="#"><i class="fal fa-trash"></i> Hapus Chat </a>
         <a id="ratechat" class="btn btn-block danger waves-effect waves-effect" href="#"><i class="fal fa-star"></i> Lihat Penilaian </a>
        </center>
        </div>
        
        <br clear="all"><br clear="all">
        
		</div>
        <br><br>
			  	<div id="attach" class="animated fadeinup" style="display:none">
		  	<div id="foto" style="display:none" class="animated fadeindown">
				<img src="" id='img' style="width: 100%; height: auto; border-radius:10px">
				<br/>
				<input type="hidden" name="isimage_" id="isimage_" value="0">
				<span id="kirim_" style="text-center"></span>
			</div>
			<div id="audiox" style="display:none" class="animated fadeindown">
				<div class="rekaman"></div>
				<br/>
				<input type="hidden" name="isimage" id="isimage" value="0">
				<span id="kirim" style="text-center"></span>
			</div>
			<div id="templatex" style="display:none" class="animated fadeindown">
				<div class="templates"></div>
			</div>
		  	<div id="tools">
		  <button class="waves-effect waves-light btn-large accent-color m-b-20 button button-block button-positive" id="but_take_">Kamera</button>
		  <button class="waves-effect waves-light btn-large accent-color m-b-20 button button-block button-positive" id="but_select_">Galeri Foto</button>
		  <button class="waves-effect waves-light btn-large accent-color m-b-20 button button-block button-positive" id="but_take">Rekam Audio</button>
		  <button class="waves-effect waves-light btn-large accent-color m-b-20 button button-block button-positive" id="but_select">File Audio</button>
		  <button class="waves-effect waves-light btn-large accent-color button button-block button-positive" id="but_template" style="width:94% !Important">Template Pesan</button>
	  		</div>
		</div>
        <div class="steps-controllers chatbottom">
           <div id="default" style="width:100%" class="animated fadeindown">
	           <div class="chat-input">
	           		<textarea id="sendie" class="resize-ta" maxlength= "1000" placeholder="Tulis pesan disini"></textarea>
	           </div>
			   <div class="chat-input-image" id="sendx" style="display:none;">
	           	 <a href="#" class="waves-ripple waves-effect animated fadeindown" id="sends" style="color:#fff;background-color: rgb(102, 152, 32);"><i class="fal fa-paper-plane"></i></a>
			 </div> 
	           <div class="chat-input-image">
	           	 <a href="#" class="waves-ripple waves-effect animated fadeinup" onclick="attach()" id="attachs"><i class="fal fa-paperclip"></i></a>
	           </div>  
			   <div class
			   ="chat-input-image">
	           	 <a href="#" class="waves-ripple waves-effect animated fadeindown" onclick="attachx()" id="attachx" style="display:none"><i class="fal fa-times"></i></a>
			 </div> 
		 </div>
             
       </div>
 </div> <!-- End of Page Container -->
 	
    <script>
		function delchat(){
			var chatid_ = getvar("chatid");
        	var urls ="https://www.dfunstation.com/api4/consultant/index.php/konsultasi/delete/"+localStorage.userid+"/"+chatid_+"/?callback=?";
            $.ajax({
            	type: "GET",
               	url: urls,
              	crossDomain: true,
               	cache: false,
               	success: function(data){
	               	if(data['status']=="OK"){
	               		slide('konsultan_chat_arsip.html');
	               	}
               	}
         	});
        }
		$( document ).ready(function() {
			var h = $(window).innerHeight();
			var tinggi = h-132;
			$("#chat-area").height(tinggi);
		});
	</script>

	<script type='text/javascript'>
		$(document).ready(function(){
			$('#but_template').click(function(){
				$("#templatex").show();
				$("#tools").hide();
			});
			
			$('#but_take_').click(function(){
				navigator.camera.getPicture(onSuccess, onFail, { quality: 100,
					destinationType: Camera.DestinationType.FILE_URL 
				});
			});
		
			$("#but_select_").click(function(){
				navigator.camera.getPicture(onSuccess, onFail, { quality: 100,
					sourceType: Camera.PictureSourceType.PHOTOLIBRARY, 
					allowEdit: true,
					destinationType: Camera.DestinationType.FILE_URI
				});
			});
		
			// Change image source
			function onSuccess(imageData) {
				var image = document.getElementById('img');
				if (imageData.startsWith("content://")) {
					window.FilePath.resolveNativePath(imageData, function(localFileUri) {
						$("#img").attr("src", localFileUri + '?' + Math.random());
						if(localFileUri!=="") {
							$("#foto").show();
							$("#tools").hide();
							$("#sendx").show();
						}
					});
				} else {
					$("#img").attr("src", imageData + '?' + Math.random());
					if(imageData!=="") {
						$("#foto").show();
						$("#tools").hide();
						$("#sendx").show();
					}
				}
				$("#isimage_").val("1");
			}
		
			function onFail(message) {
				swal('Gagal mengambil gambar: ' + message);
			}
		});
	</script>
            
    <script type='text/javascript'>
		$(document).ready(function(){
			function audioCapture() {
				var options = {
					limit: 1,
					duration: 300
				};
				navigator.device.capture.captureAudio(onSuccess, onError, options);
					
				function onSuccess(mediaFiles) {
					var i, path, len;
					for (i = 0, len = mediaFiles.length; i < len; i += 1) {
						path = mediaFiles[i].fullPath;
						$(".rekaman").html('<audio controls><source src="'+path+'" type="audio/mp4" id="audio">Your browser does not support the video tag.</audio></div>');
						$("#audiox").show();
						$("#tools").hide();
						$("#sendx").show();
						$("#isimage").val("1");
					}
				}
					
				function onError(error) {
					navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
				}
			}
			$('#but_take').click(function(){
				audioCapture();
			});	
		});
				
		$("#but_select").click(function(){
			navigator.camera.getPicture(onSuccess, onFail, { quality: 100,
				destinationType: Camera.DestinationType.FILE_URI,
				sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
				mediaType: Camera.MediaType.ALLMEDIA
			});
		});
		
		function onSuccess(imageData) {
			$(".rekaman").html('<audio controls><source src="'+imageData+'" type="audio/mp4" id="audio">Your browser does not support the video tag.</audio></div>');
			$("#audiox").show();
			$("#tools").hide();
			$("#sendx").show();
			$("#isimage").val("1");
		}
		
		function onFail(message) {
			swal('Gagal mengambil Audio, ' + message);
		}	
	</script>
   
    
    <script type="text/javascript" src="cordova.js"></script>
    <script src="js/jquery.swipebox.min.js"></script>   
    <script src="js/jquery.smoothState.min.js"></script> 
    <script src="js/materialize.min.js"></script> 
    <script src="js/swiper.min.js"></script>  
    <script src="js/jquery.mixitup.min.js"></script>
    <script src="js/masonry.min.js"></script>
    <script src="js/chart.min.js"></script>
    <script src="js/functions.js"></script>
	<div id="myModal" class="modalx">
        <!-- Modal content -->
        <div class="modal-contentx">
        <a href="" class="close" id="dnx" style="float:left"><i class="fal fa-download"></i></a><span class="close" onclick="modalc()"><i class="fal fa-times"></i></span>
          <img src="" id="imgx">
        </div>
      
      </div>
  </body>
</html>